!function($){"use strict";var o=$(document);o.on("keydown",function(o){if(!$("body").hasClass("cv-suspend-modal-events"))if($("body").hasClass("cv-shortcode-content-wp-editor-active"))switch(o.keyCode){case 27:$("#cv-shortcode-content-wp-editor-wrap-cancel").trigger("click"),o.stopImmediatePropagation(),o.preventDefault();break;case 13:if(o.target.tagName&&"textarea"===o.target.tagName.toLowerCase())return;$("#cv-shortcode-content-wp-editor-wrap-submit").trigger("click"),o.stopImmediatePropagation(),o.preventDefault()}else if($("body").hasClass("cv-composer-active"))switch(o.keyCode){case 27:$("#cv-composer-absolute-container").children().last().trigger("cancel-modal"),o.stopImmediatePropagation(),o.preventDefault();break;case 13:if(o.target.tagName&&"textarea"===o.target.tagName.toLowerCase())return;$("#cv-composer-absolute-container").children().last().trigger("submit-modal"),o.stopImmediatePropagation(),o.preventDefault()}}),$.CVComposerModal=function(o){var t={title:null,action:null,content:null,ajax_callback:null,ajax_url:null,ajax_param:"",add_class:"",modal_content:null,submit_button:!0,cancel_button:!0,on_start:function(){},on_load:function(){},on_submit:function(){},on_cancel:function(){},on_close:function(){}};if(this.config=$.extend({},t,o),this.config.content||this.config.ajax_callback||this.config.ajax_url){var e=50;this.config.title.length>e&&(this.config.title=this.config.title.substring(0,e),this.config.title=this.config.title+"..."),this.$modal=$($("#cv-tmpl-composer-modal").html()),this.$overlay=this.$modal.find(".cv-composer-overlay"),this.$title=this.$modal.find(".cv-composer-title"),$("#cv-composer-absolute-container").append(this.$modal),$("body").addClass("cv-composer-active"),this.config.on_start(this.$modal),this.init()}},$.CVComposerModal.prototype={init:function(){this.attach_events(),this.set_html(),this.start()},attach_events:function(){var o=this;o.$modal.on("click",function(t){"cv-composer-overlay"===$(t.target).attr("class")&&o.$modal.trigger("cancel-modal")}),o.config.submit_button&&o.$modal.find(".cv-composer-submit").eq(0).on("click",function(){o.$modal.trigger("submit-modal")}),o.config.cancel_button&&o.$modal.find(".cv-composer-cancel").eq(0).on("click",function(){o.$modal.trigger("cancel-modal")}),o.$modal.on("submit-modal",function(){o.config.on_submit(o.$modal),o.close()}),o.$modal.on("cancel-modal",function(){o.config.on_cancel(o.$modal),o.close()})},set_html:function(){var o=this;o.$title.html(o.config.title),o.$modal.addClass(o.config.add_class),o.config.submit_button||o.$modal.find(".cv-composer-submit").eq(0).remove(),o.config.cancel_button||o.$modal.find(".cv-composer-cancel").eq(0).remove(),o.$modal.find(".cv-composer-modal").eq(0).css("min-height",parseInt($(window).outerHeight())-55)},start:function(){var o=this;if(o.config.content)return o.$modal.find(".cv-composer-modal").eq(0).html(o.config.content),void o.open();var t={param:o.config.ajax_param};o.config.ajax_url||(t.action="cv_ajax_"+o.config.ajax_callback);var e=o.config.ajax_url?o.config.ajax_url:cv_modal_localize.ajax_url;$.ajax({type:"POST",url:e,data:t,error:function(){alert(cv_modal_localize.ajax_error)},success:function(t){0===t?alert(cv_modal_localize.ajax_logged_out):"-1"===t?alert(cv_modal_localize.ajax_nonce_error):(o.$modal.find(".cv-composer-modal").eq(0).html(t),o.open())}})},open:function(){var t=this;setTimeout(function(){t.config.on_load(t.$modal),t.$modal.find(".cv-composer-container").eq(0).css("opacity",1),o.trigger("dom-change"),o.trigger("cv-composer-load"),o.trigger("cv-composer-load-"+t.config.action),t.activateSorting()},10)},close:function(){var o=this;o.config.on_close(o.$modal),o.$modal.remove(),$("#cv-composer-absolute-container").children().length||$("body").removeClass("cv-composer-active")},activateSorting:function(){$(".cv-sortzone").each(function(){var o=$(this);o.sortable({placeholder:"cv-module-placeholder",appendTo:o,helper:"clone",start:function(o,t){t.helper.addClass("cv-dragging"),t.placeholder.css("height",t.helper.outerHeight()),t.placeholder.css("width",t.helper.outerWidth())}})}),$(".cv-list-items").each(function(){var o=$(this);o.sortable({placeholder:"cv-list-placeholder",appendTo:o,helper:"clone",start:function(o,t){t.helper.addClass("cv-dragging"),t.placeholder.css("height",t.helper.height()),t.placeholder.css("width",t.helper.width())}})})}}}(jQuery);