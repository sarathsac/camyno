!function($){var e=$(document);$.CV_Template_Builder=function(){this.$builder=$("#cv-builder"),this.$toolbar=$("#cv-toolbar"),this.$canvas=$("#cv-builder-canvas"),this.$history=$("#cv-history"),this.$activeEditor=$("#cv-active-editor"),this.$templateValue=$("#cv-page-template-value"),this.$defaultEditor=$("#cv-default-editor-wrap"),this.$advancedEditor=$("#cv_template_builder"),this.init()},$.CV_Template_Builder.prototype={init:function(){this.applyEvents(),$("body").append('<div id="cv-loading-indicator"><div class="loading-icon"></div> '+cv_builder_localize.builder_loading+"</div>")},applyEvents:function(){var t=this;e.on("keydown",function(e){27===e.keyCode&&$("body").hasClass("cv-fullscreen-active")&&(e.stopImmediatePropagation(),e.preventDefault(),$("#cv-toggle-fullscreen").trigger("click"))}),$("#cv-toggle-active-editor").on("click",function(e){e.preventDefault(),t.toggleEditor()}),$("#cv-toggle-fullscreen").on("click",function(e){e.preventDefault(),t.toggleFullScreen()}),$("#post").on("submit",function(){t.updateBuilderValue()}),e.on("click",".cv-composer-content-editor-current-content-preview, .cv-composer-content-editor-current-content-preview *",function(e){e.preventDefault();var t=$(this).closest(".cv-composer-content-editor-wrap").find(".cv-composer-content-editor-launch").trigger("click")}),e.on("click",".cv-composer-content-editor-launch",function(){var e=$(this).closest(".cv-composer-content-editor-wrap").find(".cv-composer-content-editor-current-content").val();if(e){var t=$("#wp-shortcode_wp_editor_content-wrap").hasClass("tmce-active");t&&$("#shortcode_wp_editor_content-html")[0].click(),$("#shortcode_wp_editor_content").val(e),t&&$("#shortcode_wp_editor_content-tmce")[0].click()}$("body").addClass("cv-shortcode-content-wp-editor-active")}),e.on("click","#cv-shortcode-content-wp-editor-wrap-cancel",function(){var e=$("#wp-shortcode_wp_editor_content-wrap").hasClass("tmce-active");e&&$("#shortcode_wp_editor_content-html")[0].click(),$("#shortcode_wp_editor_content").val(""),e&&$("#shortcode_wp_editor_content-tmce")[0].click(),$("body").removeClass("cv-shortcode-content-wp-editor-active")}),e.on("click","#cv-shortcode-content-wp-editor-wrap-submit",function(){var e=$("#wp-shortcode_wp_editor_content-wrap").hasClass("tmce-active");e&&$("#shortcode_wp_editor_content-html")[0].click();var t=$("#shortcode_wp_editor_content").val();$("#shortcode_wp_editor_content").val(""),e&&$("#shortcode_wp_editor_content-tmce")[0].click(),$("#cv-composer-absolute-container").children().last().find(".cv-composer-content-editor-current-content").val(t),$("#cv-composer-absolute-container").children().last().find(".cv-composer-content-editor-current-content-preview").html(window.switchEditors.wpautop(t)),$("body").removeClass("cv-shortcode-content-wp-editor-active")}),e.on("click",".show-shortcode-explanation",function(){$(this).hide().next().show()}),e.on("click",".shortcode-explanation",function(){$(this).hide().prev().show()}),e.on("click",".cv-module-remove",function(e){$(e.target).closest(".cv-builder-module").trigger("remove-module")}),e.on("remove-module",".cv-builder-module",function(e){e.stopPropagation(),t.removeModule($(e.target))}),e.on("click",".cv-module-duplicate",function(e){$(e.target).closest(".cv-builder-module").trigger("duplicate-module")}),e.on("duplicate-module",".cv-builder-module",function(e){e.stopPropagation(),t.duplicateModule($(e.target))}),e.on("click",".cv-module-edit",function(e){$(e.target).closest(".cv-builder-module").trigger("edit-module")}),e.on("edit-module",".cv-builder-module",function(e){e.stopPropagation(),t.editModule($(e.target))}),t.$canvas.on("click",".cv-module-move-up",function(e){$(e.target).closest(".cv-builder-module").trigger("move-module-up")}),t.$canvas.on("move-module-up",".cv-builder-module",function(e){e.stopPropagation(),t.moveModuleUp($(e.target))}),t.$canvas.on("click",".cv-module-move-down",function(e){$(e.target).closest(".cv-builder-module").trigger("move-module-down")}),t.$canvas.on("move-module-down",".cv-builder-module",function(e){e.stopPropagation(),t.moveModuleDown($(e.target))}),$("#cv-preview-changes").on("click",function(){$("#post-preview").trigger("click")}),$("#cv-save-changes").on("click",function(){$("#publish").trigger("click")}),e.on("click",".cv-add-module",function(){var i=$(this),n=i.prev(),o=i.children("span").eq(0).html();if(i.data("handle")){var a=i.data("handle"),r=$($("#tmpl-cv-builder-"+a).html());return n.append(r),void e.trigger("dom-change")}var c=i.data("droptarget");new $.CVComposerModal({title:o,submit_button:!1,content:$("#tmpl-cv-builder-module-options-dropzone-"+c).html(),on_load:function(i){var o=0;i.on("mousedown",".cv-composer-available-module",function(){var e=$(this);o=setTimeout(function(){e.trigger("clickhold")},250)}).on("mouseup mouseleave",function(){clearTimeout(o)}),i.on("click clickhold",".cv-composer-available-module",function(o){o.preventDefault();var a=$(this).data("handle"),r=$($("#tmpl-cv-builder-"+a).html());n.append(r),e.trigger("dom-change"),t.captureState(cv_builder_localize.add_module_title.replace("%s",r.data("title")),"plus-circled"),i.trigger("submit-modal"),"clickhold"===o.type&&r.find(".cv-module-edit").eq(0).trigger("click")})}})}),t.$toolbar.on("click",".cv-dropdown-control > a",function(){var e=$(this).closest(".cv-dropdown-control");if(!e.hasClass("is-disabled")){var t=e.children(".cv-dropdown").eq(0);if(e.siblings().removeClass("is-active"),e.toggleClass("is-active"),t.hasClass("cv-history")&&t[0].scrollHeight>t.height()){var i=0,n;t.children(".cv-state-container.active-item").eq(0).prevAll().each(function(){n=$(this).outerHeight(),i+=parseInt(n)}),t.animate({scrollTop:i},500)}}}),t.$canvas.on("click mousedown touchstart",function(){t.$toolbar.find(".cv-dropdown-control.is-active").eq(0).removeClass("is-active")}),t.captureState(cv_builder_localize.launch_builder,"rocket"),t.$history.on("click","a",function(){var e=$(this);e.parent().siblings(".active-item").eq(0).removeClass("active-item"),e.parent().addClass("active-item");var i=e.next().val();t.insertTemplate(i,"replace",!1),t.assessHistory()}),$("#cv-step-backward").on("click",function(){t.$history.find(".active-item").eq(0).prev().children("a").eq(0).trigger("click"),t.assessHistory()}),$("#cv-step-forward").on("click",function(){t.$history.find(".active-item").eq(0).next().children("a").eq(0).trigger("click"),t.assessHistory()}),$("#cv-cancel-new-template, #cv-add-template-button").on("click",function(){if("cv-add-template-button"===$(this).attr("id")){if(!t.captureTemplate())return void alert(cv_builder_localize.empty_template_name)}$("#cv-templates").toggleClass("cv-creating-template"),$("#cv-new-template-name").val("").trigger("focus")}),$("#cv-submit-template-name").on("click",function(){var e=t.captureTemplate(),i=$("#cv-new-template-name").val();if(i=i.replace(/[^a-z\d\s]+/gi,""),$("#cv-new-template-name").val(i),3>i.length)return void alert(cv_builder_localize.short_template_name);var n=!1;if($("#cv-templates").find(".cv-custom-template .cv-load-template").each(function(){i===$(this).data("title")&&(n=!0)}),n)return void alert(cv_builder_localize.taken_template_name);var o='<li class="cv-template-container cv-custom-template">';o+='<a class="cv-load-template has-icon" ',o+='data-title="'+i+'"',o+='><i class="icon-folder"></i>'+i,o+='<span class="cv-delete-template">'+cv_builder_localize.delete+"</span>",o+="</a>",o+='<textarea name="cv_builder_templates['+i.replace(/ /g,"")+'][template]" class="cv-saved-template">'+e+"</textarea>",o+='<input type="hidden" name="cv_builder_templates['+i.replace(/ /g,"")+'][name]" value="'+i+'" />',o+="</li>",$("#cv-templates").append(o),$("#cv-templates").removeClass("is-empty"),$("#cv-templates").removeClass("cv-creating-template"),t.updateTemplateManager()}),$("#cv-templates").on("click",".cv-load-template",function(e){if($(e.target).hasClass("cv-delete-template")){if(!confirm(cv_builder_localize.confirm_delete_template))return;var i=$(this).parent();return i.addClass("being-removed"),void setTimeout(function(){i.remove(),t.updateTemplateManager(),$("#cv-no-templates-notice").next().length||$("#cv-templates").addClass("is-empty")},500)}var n=$(this),o=n.next().val();if(t.captureTemplate()){var a=cv_builder_localize.template_modal_title.replace("%s",n.data("title"));new $.CVComposerModal({title:a,content:$("#tmpl-cv-builder-template-options").html(),submit_button:!1,on_load:function(e){e.on("click",".cv-composer-large-option",function(){var i=$(this).data("action");t.insertTemplate(o,i,!0,function(){t.captureState(cv_builder_localize[i+"_template_title"].replace("%s",n.data("title")),"flash")}),e.trigger("submit-modal")})}})}else t.insertTemplate(o,"replace",!0,function(){t.captureState(cv_builder_localize.load_template_title.replace("%s",n.data("title")),"flash")});$("#cv-toolbar-templates").removeClass("is-active")}),t.applySorting(),e.on("dom-change",$.proxy(t.applySorting,t))},toggleEditor:function(){var t=this,i=t.$activeEditor.val(),n=$("#cv-toggle-active-editor"),o;switch(i){case"default":o="advanced";break;case"advanced":o="default"}$("body").toggleClass("cv-builder-active cv-builder-hidden"),n.toggleClass("button-primary"),n.html(n.data(o+"-label")),t.$activeEditor.val(o),e.trigger("dom-change");var a={current_editor:o,post_ID:n.data("post-id"),action:"cv_ajax_update_editor_value"};$.ajax({type:"POST",url:cv_builder_localize.ajax_url,data:a})},toggleFullScreen:function(){var e=this,t=$("#cv-toggle-fullscreen");e.$builder.toggleClass("is-fullscreen"),$("body").toggleClass("cv-fullscreen-active"),e.$builder.hasClass("is-fullscreen")?t.html(t.data("compress")):t.html(t.data("expand"))},assessHistory:function(){var e=this,t=e.$history.find(".active-item").eq(0),i=$("#cv-step-backward").parent(),n=$("#cv-step-forward").parent();1<e.$history.children().length&&e.$history.parent().removeClass("is-disabled"),0===t.prevAll().length?i.addClass("is-disabled"):i.removeClass("is-disabled"),0===t.nextAll().length?n.addClass("is-disabled"):n.removeClass("is-disabled")},applySorting:function(){var t=this;$(".cv-dropzone").each(function(){var i=$(this),n=i.data("dropzone");i.data("cvdrop")||(i.data("cvdrop",!0),i.sortable({connectWith:'.cv-dropzone[data-dropzone="'+n+'"]',placeholder:"cv-module-placeholder",appendTo:"#cv-builder",helper:"clone",start:function(i,n){var o=$(i.srcElement);if(o.hasClass("cv-module-duplicate")||o.parent().hasClass("cv-module-duplicate")){var a=o.closest(".cv-builder-module"),r=a.clone().removeAttr("style");a.parent().addClass("hide-placeholder"),a.after(r),e.trigger("dom-change"),t.captureState(cv_builder_localize.duplicate_module_title.replace("%s",n.item.data("title")),"docs")}n.item.data("start-pos",n.item.index()),n.item.data("start-dropzone",n.item.parent()),n.helper.addClass("cv-dragging"),n.placeholder.css("height",n.helper.outerHeight())},stop:function(i,n){n.item.data("start-dropzone").removeClass("is-empty hide-placeholder"),n.item.data("start-pos")===n.item.index()&&n.item.data("start-dropzone").is(n.item.parent())||(t.captureState(cv_builder_localize.move_module_title.replace("%s",n.item.data("title")),"shuffle"),e.trigger("cv-composer-module-dropped"))},over:function(t,i){$(i.placeholder).parent().removeClass("hide-placeholder"),1===i.item.data("start-dropzone").children().length&&"none"===i.item.data("start-dropzone").children().eq(0).css("display")&&i.item.data("start-dropzone").addClass("is-empty"),2===i.item.data("start-dropzone").children().length&&i.item.data("start-dropzone").removeClass("is-empty"),e.trigger("cv-composer-module-over")}}))})},removeModule:function(t){var i=this,n=t.data("droptarget");return t.remove(),e.trigger("dom-change"),void(3!==n&&i.captureState(cv_builder_localize.remove_module_title.replace("%s",t.data("title")),"trash"));i.$canvas.css("height","auto"),t.addClass("being-removed").css("height",t.outerHeight()),setTimeout(function(){t.addClass("is-removed"),setTimeout(function(){t.remove(),e.trigger("dom-change"),3!==n&&i.captureState(cv_builder_localize.remove_module_title.replace("%s",t.data("title")),"trash")},260)},10)},duplicateModule:function(t){var i=this,n=t.clone(),o=t.outerHeight(),a=t.data("droptarget");i.$canvas.css("height","auto"),n.addClass("being-added is-added"),n.css("height","0px !important"),t.after(n),setTimeout(function(){n.css("height",o).removeClass("is-added"),setTimeout(function(){n.removeClass("being-added"),n.removeAttr("style"),e.trigger("dom-change"),3!==a&&i.captureState(cv_builder_localize.duplicate_module_title.replace("%s",n.data("title")),"docs")},260)},10)},editModule:function(t){var i=this,n=t.data("handle"),o=cv_builder_localize.edit_module_title.replace("%s",t.data("title")),a=i.captureModuleShortcode(t),r=t.data("droptarget");i.startLoading(),new $.CVComposerModal({title:o,action:n,ajax_callback:"render_composer_controls",ajax_param:a,add_class:"editing-"+n,on_load:function(){i.doneLoading()},on_submit:function(o){var a={},c="",l,s;t.addClass("being-edited"),a.handle=n,a.attributes={},o.find("#cv-composer-form .standard-attributes .control-wrap").each(function(){switch(s=$(this),s.data("type")){case"layout":case"iconpicker":case"bg-pattern":l=s.find("[name]:checked"),a.attributes[l.attr("name")]=l.val();break;case"list":var e="";l=s.find("[name]");var t=l.data("separator");l.next().children().each(function(){e+=$(this).find("span").html()+t}),e=e.slice(0,-1),a.attributes[l.attr("name")]=e;break;case"multiple-select":l=s.find("[name]"),e=l.val()?l.val().join(","):"",a.attributes[l.attr("name")]=e;break;default:l=s.find("[name]"),a.attributes[l.attr("name")]=l.val()}}),o.find(".content-elements").length?(o.find(".cv-builder-piece").each(function(){c+=$(this).val()}),a.content=c):o.find(".cv-composer-content-editor-current-content").length?a.content=o.find(".cv-composer-content-editor-current-content").val():o.find('textarea[name="shortcode_dropzone_content"]').length&&(a.content=o.find('textarea[name="shortcode_dropzone_content"]').val()),a=JSON.stringify(a),i.startLoading();var d={submitted:a,action:"cv_ajax_refresh_edited_module"};$.ajax({type:"POST",url:cv_builder_localize.ajax_url,data:d,success:function(n){var o=$(n),a=i.captureModuleShortcode(t);t.replaceWith(o),i.$builder.imagesLoaded(function(){e.trigger("dom-change")}),e.trigger("dom-change"),a!==i.captureModuleShortcode(o)&&3!==r&&i.captureState(cv_builder_localize.edit_module_title.replace("%s",o.data("title")),"pencil"),i.doneLoading()}})}})},moveModuleUp:function(t){var i=this,n=t.clone();if(!t.prev().length)return void alert(cv_builder_localize.module_at_top);t.parent().prepend(n),t.remove(),e.trigger("dom-change"),i.captureState(cv_builder_localize.move_module_up_title.replace("%s",t.data("title")),"up-dir")},moveModuleDown:function(t){var i=this,n=t.clone();if(!t.next().length)return void alert(cv_builder_localize.module_at_bottom);t.parent().append(n),t.remove(),e.trigger("dom-change"),i.captureState(cv_builder_localize.move_module_down_title.replace("%s",t.data("title")),"down-dir")},captureModuleShortcode:function(e){var t="";return e.find(".cv-builder-piece").each(function(){t+=$(this).val()}),t},captureTemplate:function(){var e=this,t="";return e.$canvas.find(".cv-builder-piece").each(function(){t+=$(this).val()}),t},updateBuilderValue:function(){var e=this,t=this.captureTemplate();e.$templateValue.val(t)},updateTemplateManager:function(){var e={},t,i,n,o;$("#cv-templates").find(".cv-custom-template").each(function(){t=$(this),n=t.find("input").val(),o=t.find("textarea").val(),i=n.replace(/ /g,""),e[i]={},e[i].name=n,e[i].template=o});var a={templates:JSON.stringify(e),action:"cv_ajax_update_template_manager"};$.ajax({type:"POST",url:cv_builder_localize.ajax_url,data:a,error:function(){alert(cv_builder_localize.error_loading_template)}})},captureState:function(e,t){var i=this;t||(t="arrows-ccw");var n=i.captureTemplate(),o='<li class="cv-state-container active-item">';o+='<a class="cv-state-button has-icon"><i class="icon-'+t+'"></i>'+e+"</a>",o+='<textarea class="cv-state-template">'+n+"</textarea>",o+="</li>",i.$history.children(".active-item").eq(0).nextAll().remove(),i.$history.children(".active-item").eq(0).removeClass("active-item"),i.$history.append(o),i.assessHistory()},insertTemplate:function(t,i,n,o){var a=this,r=a.$canvas.children().eq(0),c,l={template:t,action:"cv_ajax_load_template"};a.startLoading(),$.ajax({type:"POST",url:cv_builder_localize.ajax_url,data:l,success:function(t){switch(c=t?$(n?'<div class="cv-new-modules">'+t+"</div>":t):"",i){case"prepend":r.prepend(c);break;case"replace":r.html(c);break;case"append":r.append(c)}t&&n&&setTimeout(function(){c.addClass("being-added"),setTimeout(function(){c.children().eq(0).unwrap()},760)},10),o&&"function"==typeof o&&o(),a.doneLoading(),e.trigger("dom-change")}})},startLoading:function(){$("body").addClass("cv-builder-is-loading cv-suspend-modal-events")},doneLoading:function(){$("body").removeClass("cv-builder-is-loading cv-suspend-modal-events")}},e.on("ready",function(){e.data("cv-template-builder",new $.CV_Template_Builder)})}(jQuery),function(){function e(){}function t(e,t){for(var i=e.length;i--;)if(e[i].listener===t)return i;return-1}function i(e){return function(){return this[e].apply(this,arguments)}}var n=e.prototype,o=this,a=o.EventEmitter;n.getListeners=function(e){var t,i,n=this._getEvents();if("object"==typeof e){t={};for(i in n)n.hasOwnProperty(i)&&e.test(i)&&(t[i]=n[i])}else t=n[e]||(n[e]=[]);return t},n.flattenListeners=function(e){var t,i=[];for(t=0;e.length>t;t+=1)i.push(e[t].listener);return i},n.getListenersAsObject=function(e){var t,i=this.getListeners(e);return i instanceof Array&&(t={},t[e]=i),t||i},n.addListener=function(e,i){var n,o=this.getListenersAsObject(e),a="object"==typeof i;for(n in o)o.hasOwnProperty(n)&&-1===t(o[n],i)&&o[n].push(a?i:{listener:i,once:!1});return this},n.on=i("addListener"),n.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},n.once=i("addOnceListener"),n.defineEvent=function(e){return this.getListeners(e),this},n.defineEvents=function(e){for(var t=0;e.length>t;t+=1)this.defineEvent(e[t]);return this},n.removeListener=function(e,i){var n,o,a=this.getListenersAsObject(e);for(o in a)a.hasOwnProperty(o)&&-1!==(n=t(a[o],i))&&a[o].splice(n,1);return this},n.off=i("removeListener"),n.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},n.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},n.manipulateListeners=function(e,t,i){var n,o,a=e?this.removeListener:this.addListener,r=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(n=i.length;n--;)a.call(this,t,i[n]);else for(n in t)t.hasOwnProperty(n)&&(o=t[n])&&("function"==typeof o?a.call(this,n,o):r.call(this,n,o));return this},n.removeEvent=function(e){var t,i=typeof e,n=this._getEvents();if("string"===i)delete n[e];else if("object"===i)for(t in n)n.hasOwnProperty(t)&&e.test(t)&&delete n[t];else delete this._events;return this},n.removeAllListeners=i("removeEvent"),n.emitEvent=function(e,t){var i,n,o,a,r=this.getListenersAsObject(e);for(o in r)if(r.hasOwnProperty(o))for(n=r[o].length;n--;)i=r[o][n],i.once===!0&&this.removeListener(e,i.listener),(a=i.listener.apply(this,t||[]))===this._getOnceReturnValue()&&this.removeListener(e,i.listener);return this},n.trigger=i("emitEvent"),n.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},n.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},n._getOnceReturnValue=function(){return!this.hasOwnProperty("_onceReturnValue")||this._onceReturnValue},n._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return o.EventEmitter=a,e},"function"==typeof define&&define.amd?define("eventEmitter/EventEmitter",[],function(){return e}):"object"==typeof module&&module.exports?module.exports=e:this.EventEmitter=e}.call(this),function(e){function t(t){var i=e.event;return i.target=i.target||i.srcElement||t,i}var i=document.documentElement,n=function(){};i.addEventListener?n=function(e,t,i){e.addEventListener(t,i,!1)}:i.attachEvent&&(n=function(e,i,n){e[i+n]=n.handleEvent?function(){var i=t(e);n.handleEvent.call(n,i)}:function(){var i=t(e);n.call(e,i)},e.attachEvent("on"+i,e[i+n])});var o=function(){};i.removeEventListener?o=function(e,t,i){e.removeEventListener(t,i,!1)}:i.detachEvent&&(o=function(e,t,i){e.detachEvent("on"+t,e[t+i]);try{delete e[t+i]}catch(n){e[t+i]=void 0}});var a={bind:n,unbind:o};"function"==typeof define&&define.amd?define("eventie/eventie",a):e.eventie=a}(this),function(e,t){"function"==typeof define&&define.amd?define(["eventEmitter/EventEmitter","eventie/eventie"],function(i,n){return t(e,i,n)}):"object"==typeof exports?module.exports=t(e,require("wolfy87-eventemitter"),require("eventie")):e.imagesLoaded=t(e,e.EventEmitter,e.eventie)}(window,function(e,t,i){function n(e,t){for(var i in t)e[i]=t[i];return e}function o(e){return"[object Array]"===v.call(e)}function a(e){var t=[];if(o(e))t=e;else if("number"==typeof e.length)for(var i=0,n=e.length;n>i;i++)t.push(e[i]);else t.push(e);return t}function r(e,t,i){if(!(this instanceof r))return new r(e,t);"string"==typeof e&&(e=document.querySelectorAll(e)),this.elements=a(e),this.options=n({},this.options),"function"==typeof t?i=t:n(this.options,t),i&&this.on("always",i),this.getImages(),s&&(this.jqDeferred=new s.Deferred);var o=this;setTimeout(function(){o.check()})}function c(e){this.img=e}function l(e){this.src=e,p[e]=this}var s=e.jQuery,d=e.console,u=void 0!==d,v=Object.prototype.toString;r.prototype=new t,r.prototype.options={},r.prototype.getImages=function(){this.images=[];for(var e=0,t=this.elements.length;t>e;e++){var i=this.elements[e];"IMG"===i.nodeName&&this.addImage(i);var n=i.nodeType;if(n&&(1===n||9===n||11===n))for(var o=i.querySelectorAll("img"),a=0,r=o.length;r>a;a++){var c=o[a];this.addImage(c)}}},r.prototype.addImage=function(e){var t=new c(e);this.images.push(t)},r.prototype.check=function(){function e(e,o){return t.options.debug&&u&&d.log("confirm",e,o),t.progress(e),i++,i===n&&t.complete(),!0}var t=this,i=0,n=this.images.length;if(this.hasAnyBroken=!1,!n)return void this.complete();for(var o=0;n>o;o++){var a=this.images[o];a.on("confirm",e),a.check()}},r.prototype.progress=function(e){this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded;var t=this;setTimeout(function(){t.emit("progress",t,e),t.jqDeferred&&t.jqDeferred.notify&&t.jqDeferred.notify(t,e)})},r.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";this.isComplete=!0;var t=this;setTimeout(function(){if(t.emit(e,t),t.emit("always",t),t.jqDeferred){var i=t.hasAnyBroken?"reject":"resolve";t.jqDeferred[i](t)}})},s&&(s.fn.imagesLoaded=function(e,t){return new r(this,e,t).jqDeferred.promise(s(this))}),c.prototype=new t,c.prototype.check=function(){var e=p[this.img.src]||new l(this.img.src);if(e.isConfirmed)return void this.confirm(e.isLoaded,"cached was confirmed");if(this.img.complete&&void 0!==this.img.naturalWidth)return void this.confirm(0!==this.img.naturalWidth,"naturalWidth");var t=this;e.on("confirm",function(e,i){return t.confirm(e.isLoaded,i),!0}),e.check()},c.prototype.confirm=function(e,t){this.isLoaded=e,this.emit("confirm",this,t)};var p={};return l.prototype=new t,l.prototype.check=function(){if(!this.isChecked){var e=new Image;i.bind(e,"load",this),i.bind(e,"error",this),e.src=this.src,this.isChecked=!0}},l.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},l.prototype.onload=function(e){this.confirm(!0,"onload"),this.unbindProxyEvents(e)},l.prototype.onerror=function(e){this.confirm(!1,"onerror"),this.unbindProxyEvents(e)},l.prototype.confirm=function(e,t){this.isConfirmed=!0,this.isLoaded=e,this.emit("confirm",this,t)},l.prototype.unbindProxyEvents=function(e){i.unbind(e.target,"load",this),i.unbind(e.target,"error",this)},r});